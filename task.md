# Проект "Библиотека"

## Исходные данные
- В корне проекта есть файл @librusec_local_fb2.hlc2. Это индексный файл от программы Haali Book Converter / Haali Reader
/ Haali Catalog, которые использовались для локальной библиотеки Lib.rus.ec (fb2-книги)
В этом файле хранятся данные о архиве книг.
Нас интересуют следующие данные:
    autho,
    title,
    archive_name,
    file_name,
    file_size_mb,
    genre,
    author_first_name,
    author_last_name,
    book_title,
    annotation,
    lang,
    publish_book_name,
    publisher,
    city,
    year,
    isbn
Будет папка с zip-архивами книг @books/, где имя архива соответствует archive_name, а файл внутри архива соответствует file_name.

## Функциональные требования
- Должен быть эндпоинт, который будет получать строку запроса. По строке запроса должен выполняться поиск с использованием
elasticsearch и возвращаться список книг со всеми доступными полями из БД включая ID в JSON формате.
- Должен быть эндпоинт, который будет получать ID книги, разорхивировать нужный архив во временную папку,
брать оттуда нужный файл книги, и загружать в S3-совместимое хранилище с именем, составленным из аттрибутов
(автор, название, год издания, размер файла в Мб), отвечать JSON содержащий путь к загруженному файлу. Файл в S3-хранилище
должен помещаться временно на срок 1 неделя. Перед тем, как распаковать архив нужно сначала проверить, нет ли уже
файла в S3-хранилище с таким именем, и если есть, то не распаковывать, а сразу возвращать путь к уже существующему файлу.
- Должен быть эндпоинт для проверки работоспособности сервиса
- Должно быть полное логгирование (совместимое с prometheus)

## Инфраструктурные требования
- Запуск и тестирование внутри docker с использованием docker-compose. Т.е. запуск тестов как docker-compose run --rm app sh -c "pytest".
Должны подниматься все необходимые сервисы и проводится интеграционное тестирование с реальной БД и S3, а не к mock-объектам
Нужны тесты всех эндпоинтов. Для тестирования эндпоинта с загрузкой в S3 создавать на диске реальный архив с fb2 файлом.
- Менеджер зависимостей uv
- Асинхронный FastAPI с использованием uvicorn
- База данных SQLite
- запуск приложения через docker-compose up (протестировать, что запускается)
- Для работы с зависимостями используй MCP сервер context7

## Архитектурные требования
- Работа с БД через SQLAlchemy
- Docstring в каждой функции и методе на русском в формате Google Docstring
- Настройки приложения на основании переменных среды и pydantic-модели
- Все эндпоинты должны быть async-совместимы (не должно быть блокирующих операций в эндпоинтах)
- Авторизация не требуется
- Тесты с pytest
